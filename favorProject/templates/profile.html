{% extends "base.html" %} {% load static %} {% block pageHeader %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/login.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/profile.css' %}">
{% endblock pageHeader%}
{% block pageContent %}
<div class="text-center center-main">
    <h2 class="display-4 text-center">My Account</h2>
    <h2 class="display-5 text-center">Favors I'm Offering</h2>
    <table class="table table-striped table-bordered table-hover">
        <thead class="custom">
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Description</th>
                <th scope="col">Cost</th>
                <th scope="col">Location</th>
                <th scope="col">Actions</th>
                <th scope="col">Pending Users</th>
            </tr>
        </thead>
        <tbody>
            {% for f in ownedFavors %}
                <tr>
                    <td style="width: 10vw">{{ f.title }}</td>
                    <td style="width: 15vw">{{ f.description }}</td>
                    <td style="width: 7vw">{{ f.number_of_favors }} favors</td>
                    <td style="width: 10vw;">{{ f.location }}</td>
                    <td>
                        <a class="btn btn-success" href="/edit/{{ f.id }}">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form 
                            action="/delete-favor-object/"
                            method="POST"> {% csrf_token %}
                            <input type='hidden' value='{{f.id}}' name='favor_id'>
                            <button class="btn btn-danger" type="submit">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </td>
                    <td>
                        <div class="d-flex justify-content-center">
                            {% if f.pendingUsers.all %}
                                <button id="pending-user-{{ f.id }}" class="btn btn-info align-middle">
                                    <i class="fas fa-eye"></i>
                                </button>
                            {% else %}
                                <i>N/A</i>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                <div id="pending-user-modal-{{ f.id }}" class="modal fade" 
                    tabindex="-1" role="dialog" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Pending Users</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                {% for user in f.pendingUsers.all %}
                                    <div class="flex">
                                        <p>{{ user.username }}</p>
                                        <div class="flex right-align-margin">
                                            <form 
                                                action="/process-pending-user-change/"
                                                method="POST"
                                                class="right-align-margin"
                                            > {% csrf_token %} 
                                                <input type='hidden' value='{{f.id}}' name='favor_id'>
                                                <input type='hidden' value='DENY' name='action' />
                                                <input type='hidden' value='{{user.id}}' name='user_id' />
                                                <button class="btn" type="submit">
                                                    <i class='fas fa-times red pending-user-modal-icons'></i>
                                                </button>
                                            </form>
                                            <form 
                                                action="/process-pending-user-change/"
                                                method="POST"
                                                class="right-align-margin"
                                            > {% csrf_token %} 
                                                <input type='hidden' value='{{f.id}}' name='favor_id'>
                                                <input type='hidden' value='ACCEPT' name='action' />
                                                <input type='hidden' value='{{user.id}}' name='user_id' />
                                                <button class="btn" type="submit">
                                                    <i class='fas fa-check green pending-user-modal-icons'></i>
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% empty %}
            <tr><td class="empty-message" colspan="6">
                <h6><i>You are not currently the owner of any favors</i></h6>
            </td></tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="button-holder custom-margins">
        <a href="/add-favor/"><button class="btn wide-btn-2 btn-primary">Add New Favor</button></a>
    </div>
    <h2 class="display-5 text-center">Requested Favors</h2>
    <table class="table table-striped table-bordered table-hover">
        <thead class="custom">
            <tr>
                <th scope="col">Name</th>
                <th scope="col">Description</th>
                <th scope="col">Paid</th>
                <th scope="col">Location</th>
                <th scope="col">Status</th>
            </tr>
        </thead>
        <tbody>
            <tr><td class="empty-message" colspan="6"><h4>Pending Requests</h4></td></tr>
            {% for f in pendingFavors %}
                <tr>
                    <td style="width: 10vw">{{ f.title }}</td>
                    <td style="width: 15vw">{{ f.description }}</td>
                    <td style="width: 7vw">{{ f.number_of_favors }} favors</td>
                    <td style="width: 10vw;">{{ f.location }}</td>
                    <td><i>Pending</i></td>
                </tr>
            {% endfor %}
            {% if not pendingFavors %}
                <tr><td class="empty-message" colspan="6">
                    <h6><i>You have no pending favors</i></h5>
                </td></tr>
            {% endif %}
            <tr><td class="empty-message" colspan="6"><h4>Confirmed Requests</h4></td></tr>
            {% for f in confirmedFavors %}
                <tr>
                    <td style="width: 10vw">{{ f.title }}</td>
                    <td style="width: 15vw">{{ f.description }}</td>
                    <td style="width: 7vw">{{ f.number_of_favors }} favors</td>
                    <td style="width: 10vw;">{{ f.location }}</td>
                    <td><em>Confirmed</em></td>
                </tr>
            {% endfor %}
            {% if not confirmedFavors %}
                <tr><td class="empty-message" colspan="6">
                    <h6><i>You have no confirmed favors</i></h6>
                </td></tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock pageContent %}
{% block pageScripts %}
<script>
    $(document).ready(() => {
        $('td > div > button').on('click', function () {
            const favorId = $(this).attr("id").split("-")[2];
            $(`#pending-user-modal-${favorId}`).modal('show');
        });
        if ('{{ show_modal }}' === "yes") {
            $(`#pending-user-modal-{{ favor_id }}`).modal('show');
        }
    });
</script>
{% endblock pageScripts %}